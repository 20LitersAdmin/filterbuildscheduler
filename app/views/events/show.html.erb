<div class="container">
  <h1><%= @event.title %></h1>
  <% if @event.is_private %>
    <h6>This event is private</h6>
  <% end %>
  <div class="row">
    <div class="col-md-6">
      <% if current_user %>
        <h1>Register</h1>
        <%= link_to('Not you?', destroy_user_session_path, method: :delete) %>
        <%= form_for [@event, @registration] do |f| %>
          <%= f.hidden_field :event_id %>
          <%= f.hidden_field :user_id %>
          <%= f.hidden_field :leader, value: '0' %>
          <div><%= f.label :name, "Name: #{current_user.name}" %></div>
          <div><%= f.label :email, "Email: #{current_user.email}" %></div>
          <%= f.hidden_field :waiver_accepted, value: "#{current_user.waiver_accepted ? '1' : '0'}" %>
          <% if !current_user.waiver_accepted %>
            <div>
              <a target="_blank" href="/waiver"><%= f.label :waiver_accepted, 'Accept the Liability Waiver' %></a>
              <%= f.check_box :waiver_accepted, label: 'email' %>
            </div>
          <% else %>
            <div><a target="_blank" href="/waiver"><%="Review the Liability Waiver (accepted on #{current_user.signed_waiver_on})"%></a></div>
          <% end %>
          <% if current_user.can_lead_event?(@event) %>
            <div>
              <%= f.label :leader, 'Register as Leader' %>
              <%= f.check_box :leader %>
            </div>
          <% end %>
          <div>
            <%= f.label :guests_registered %>
            <%= f.number_field :guests_registered %>
          </div>
          <% if current_user.registered?(@event) %>
            <%= link_to "Change/Cancel Registration", edit_event_registration_path(@event, @registration) %>
          <% end %>
          <%= f.submit unless current_user.registered?(@event) %>
        <% end %>
      <% else %>
        <%= simple_form_for [@event, @registration] do |f| %>
          <%= f.hidden_field :event_id %>
          <%= simple_fields_for :user do |o| %>
            <%= o.input :fname, label: 'First Name' %>
            <%= o.input :lname, label: 'Last Name' %>
            <%= o.input :email, label: 'email' %>
            <%= o.hidden_field :waiver_accepted, value: '0' %>
            <div>
              <a target="_blank" href="/waiver"><%= o.label :waiver_accepted, 'Accept the Liability Waiver' %></a>
              <%= o.check_box :waiver_accepted, label: 'email' %>
            </div>
          <% end %>
          <div>
            <%= f.label :guests_registered %>
            <%= f.number_field :guests_registered %>
          </div>
          <%= f.submit %>
        <% end %>
      <% end %>
    </div>
    <div class="col-md-6">
      <h1>The Details</h1>
      <%= @event.format_time_range %>
      <h3>Location</h3>
      <h4><%= @event.location.name %></h4>
      <div><%= @event.location.address1 %></div>
      <% if @event.location.address2 %>
        <div><%= @event.location.address2 %></div>
      <% end %>
      <div><%= @event.location.city %>, <%= @event.location.state %> <%= @event.location.zip %></div>
      <% if @event.location.map_url %>
        <a target="_blank" href="<%= @event.location.map_url %>">Map</a>
      <% end %>

      <% if @event.location.instructions %>
        <h4>Instructions</h3>
        <div><%= @event.location.instructions %></div>
      <% end %>

      <% if @event.description %>
        <h4>Additional Event Details</h3>
        <div><%= @event.description %></div>
      <% end %>
    </div>
    <div class="col-md-6">
      <div class="page-header">
        <h1>Share This Event With Your Friends!</h1>
      </div>

      <div class="fb-share-button" data-href="<%= request.url %>" data-layout="button_count" data-size="small" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="<%= request.url %>">Share on Facebook</a></div>

      <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-text="Join me in building water filters!" data-show-count="false">Tweet</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

      <div id="fb-root"></div>
      <script>
        (function(d, s, id) {
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) return;
          js = d.createElement(s); js.id = id;
          js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.10&appId=1665305893501056';
          fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
      </script>
    </div>
  </div>
</div>
