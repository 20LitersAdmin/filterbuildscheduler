<div class="container">
  <h1><%= @event.title %></h1>
  <div class="row">
    <div class="col-md-6">
      <% if current_user %>
        <h1>Register</h1>
        <%= link_to('Not you?', destroy_user_session_path, method: :delete) %>
        <%= form_for [@event, @registration] do |f| %>
          <%= f.hidden_field :event_id %>
          <%= f.hidden_field :user_id %>
          <%= f.hidden_field :leader, value: '0' %>
          <div><%= f.label :name, "Name: #{current_user.name}" %></div>
          <div><%= f.label :email, "Email: #{current_user.email}" %></div>
          <%= f.hidden_field :waiver_accepted, value: "#{current_user.waiver_accepted ? '1' : '0'}" %>
          <% if !current_user.waiver_accepted %>
            <div>
              <a target="_blank" href="/waiver"><%= f.label :waiver_accepted, 'Accept the Liability Waiver' %></a>
              <%= f.check_box :waiver_accepted, label: 'email' %>
            </div>
          <% else %>
            <div><a target="_blank" href="/waiver"><%="Review the Liability Waiver (accepted on #{current_user.signed_waiver_on})"%></a></div>
          <% end %>
          <% if current_user.can_lead_event?(@event) %>
            <div>
              <%= f.label :leader, 'Register as Leader' %>
              <%= f.check_box :leader %>
            </div>
          <% end %>
          <div>
            <%= f.label :guests_registered %>
            <%= f.number_field :guests_registered %>
          </div>
          <% if current_user.registered?(@event) %>
            <%= link_to "Change/Cancel Registration", edit_event_registration_path(@event, @registration) %>
          <% end %>
          <%= f.submit unless current_user.registered?(@event) %>
        <% end %>
      <% else %>
        <%= simple_form_for [@event, @registration] do |f| %>
          <%= f.hidden_field :event_id %>
          <%= simple_fields_for :user do |o| %>
            <%= o.input :fname, label: 'First Name' %>
            <%= o.input :lname, label: 'Last Name' %>
            <%= o.input :email, label: 'email' %>
            <%= o.hidden_field :waiver_accepted, value: '0' %>
            <div>
              <a target="_blank" href="/waiver"><%= o.label :waiver_accepted, 'Accept the Liability Waiver' %></a>
              <%= o.check_box :waiver_accepted, label: 'email' %>
            </div>
          <% end %>
          <div>
            <%= f.label :guests_registered %>
            <%= f.number_field :guests_registered %>
          </div>
          <%= f.submit %>
        <% end %>
      <% end %>
    </div>
    <div class="col-md-6">
      <h1>The Details</h1>
      <%= @event.format_time_range %>
      <h3>Location</h3>
      <h4><%= @event.location.name %></h4>
      <div><%= @event.location.address1 %></div>
      <% if @event.location.address2 %>
        <div><%= @event.location.address2 %></div>
      <% end %>
      <div><%= @event.location.city %>, <%= @event.location.state %> <%= @event.location.zip %></div>
      <% if @event.location.map_url %>
        <a target="_blank" href="<%= @event.location.map_url %>">Map</a>
      <% end %>

      <% if @event.location.instructions %>
        <h4>Instructions</h3>
        <div><%= @event.location.instructions %></div>
      <% end %>

      <% if @event.description %>
        <h4>Additional Event Details</h3>
        <div><%= @event.description %></div>
      <% end %>

    </div>
  </div>
</div>
