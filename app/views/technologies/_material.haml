-# frozen_string_literal: true
:ruby
  available = material.available_count
  need = (remaining_need / part.quantity_from_material.to_f).ceil
  new_remaining_need = [need - available, 0].max
  highlight = 'color: red; font-weight: bolder; border: solid 2px red' if available < need

%tr
  - if nesting.positive?
    %td{ colspan: nesting }
  %td.right-align
    = material.uid
  %td{ colspan: 6 - nesting }
    = material.name
  %td
    = material.supplier&.name
  %td.right-align
    = human_number need
  %td.right-align{ style: highlight }
    = human_number available
  %td.right-align
    = human_number new_remaining_need
  %td.right-align
    = human_number material.goal_remainder
