-# frozen_string_literal: true

-# TODO: this should be temp, merge functionality with Order && OrderAll

:ruby
  item = assembly.item
  item_type = assembly.item_type
  available = item.available_count
  need = assembly.quantity * remainder
  new_remainder = [need - available, 0].max
  highlight = 'color: red; font-weight: bolder; border: solid 2px red' if available < need && item_type != 'Component'

%tr
  - if nesting.positive?
    %td{ colspan: nesting }
  %td.right-align
    = item.uid
  %td{ colspan: 6 - nesting }
    = item.name
  %td
    = item.supplier&.name unless item_type == 'Component'
  -# %td.right-align
  -#   = human_number need
  %td.right-align{ style: highlight }
    = human_number available
  %td.right-align
    = human_number(new_remainder) # unless item_type == 'Component'
= render partial: 'assembly', collection: item.sub_assemblies.ascending, locals: { nesting: nesting += 1, remainder: new_remainder } if item_type == 'Component' && item.sub_assemblies.any?
= render partial: 'material', object: item.material, locals: { nesting: nesting += 1, remainder: new_remainder, part: item } if item_type == 'Part' && item.material.present?

